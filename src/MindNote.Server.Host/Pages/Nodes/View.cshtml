@page
@model MindNote.Server.Host.Pages.Nodes.ViewModel
@{
    ViewData["Title"] = Model.Data.Data.Name;
    ViewData["Id"] = "Nodes";
}

@section header{
    <environment include="Development">
        <link rel="stylesheet" href="~/lib/highlight.js/styles/default.min.css">
    </environment>
    <environment exclude="Development">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/default.min.css"
              asp-fallback-href="~/lib/highlight.js/styles/default.css"
              crossorigin="anonymous" />
    </environment>
    <link rel="stylesheet" href="~/css/relation.css" />
}

<ul class="breadcrumb">
    <li class="breadcrumb-item"><a asp-page="/Index">MindNote</a></li>
    <li class="breadcrumb-item"><a asp-page="/Nodes/Index">Nodes</a></li>
    <li class="breadcrumb-item active">@Model.Data.Data.Id</li>
</ul>

<ul class="nav nav-tabs">
    <li class="nav-item">
        <a href="#content" data-toggle="tab" class="nav-link" id="aContent">
            <h4>@Html.DisplayFor(model => model.Data.Data.Name)</h4>
        </a>
    </li>
    <li class="nav-item" style="margin-top:auto; margin-left:10px"><a href="#relations" data-toggle="tab" class="nav-link active">Relations</a></li>
</ul>
<div class="tab-content pt-2" height="100%" width="100%">
    <div class="tab-pane " id="content">
        <div class="row">
            <div class="col-9" id="divMain">
                @Html.Raw(Markdig.Markdown.ToHtml(Model.Data.Data.Content ?? "", Model.MarkdownBuilder.Build()))
            </div>
            <div class="col-3" id="divSidebar">
                <dl>
                    @if (Model.Data.Tag != null)
                    {
                        <dt style="float:left; min-width:30px"><i class="fa fa-tag"></i></dt>
                        <dd>
                            <a asp-page="/Tags/View" asp-route-id="@Model.Data.Tag.Id">
                                <tag-display value="@Model.Data.Tag"></tag-display>
                            </a>
                        </dd>
                    }
                    <dd>
                        <form method="post" style="margin-left:0px; margin-top:10px;">
                            <input type="hidden" asp-for="PostData.Data.Id" value="@Model.Data.Data.Id" />
                            <div class="btn-group-toggle">
                                <a asp-page="./Edit" asp-route-id="@Model.Data.Data.Id" class="btn btn-outline-primary">
                                    <i class="fa fa-edit"></i>
                                </a>
                                <button type="submit" asp-page-handler="Delete" class="btn btn-outline-danger">
                                    <i class="fa fa-trash"></i>
                                </button>
                            </div>
                        </form>
                    </dd>
                </dl>
            </div>
        </div>
    </div>
    <div class="tab-pane active" id="relations">
        <partial name="_GraphViewerPartial" model="Model.Graph" />
    </div>
</div>

@section scripts{
    <script>
        document.getElementById("aContent").click();
    </script>

    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
        tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
        }
        });
    </script>

    <environment include="Development">
        <script src="~/lib/highlight.js/highlight.min.js"></script>
    </environment>
    <environment exclude="Development">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"
                asp-fallback-src="~/lib/highlight.js/highlight.min.js"
                crossorigin="anonymous"></script>
    </environment>

    <script>hljs.initHighlightingOnLoad();</script>
}
